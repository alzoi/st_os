# Лекция № 1
## Ссылки
https://www.youtube.com/watch?v=I5Cv_cvTaw8&list=PL8_dzIbSKnugf2XGXJE5AMU_qkxOEIz7V&index=1&t=247s  

## Загрузка ОС
Для обращения к байтам, расположенным на жестком диске, необходимо использовать библиотечные функции. Получение данных выполняется через драйвер устройства. К оперативной памяти можно обращаться напрямую по адресу байта, например, используя массивы.
![image](https://github.com/alzoi/st_os/assets/20499566/1f2fca4b-017b-49e3-964d-0a7240172714)

## Ассемблер
https://godbolt.org/  
![image](https://github.com/alzoi/st_os/assets/20499566/20273a60-b6dc-4c7f-9d49-1d61f309490e)

## Виртуальная память
https://wiki.osdev.org/Paging  
Программа оперирует виртальными адресами (или говорят ещё линейными, последовательными адресами), процессор получает виртуальный адрес, направляет его в устройство MMU и получает соответствующий физический адрес страницы памяти, которая содержит 4 КБ данных (2^12 = 4096 Байт).
Смещение в младших битах виртального адреса указывает на смещение физического адреса в выбранной странице памяти.  

Одна запись в таблицых Page Directory (PD каталог страниц) и Page Table (PT таблица страниц) занимает 4 Байта (32 бита - машинное слово для архитектуры процессора x32 или ещё указывают x86). Каталог и таблицы имеют размер в одну страницу памяти, то есть 4 КБ.  
То есть в каталоге 4096 / 4 = 1024 записи, значит мы можем создать 1024 таблицы, которые могут адресовать каждая по 1024 страниц памяти.  
Запись в странице памяти занимает 1 Байт, размер страницы 4 КБ.    
В x32 процессорах максимальный объём адресуемой физической памяти равен  
Memory Size = Page Directory * Page Table * Page = 1024 * 1024 * 4096 = 4 294 967 296 = 4 ГБ
  
Страница имеет размер 4096 Байт, т. е. 2^12 Байт.  
Это означает, что страницы выравниваются по размеру, кратному 4 КБ, и что адрес страницы равен **xxxxxxxxxxxxxxxxxxxx000000000000**. Другими словами, адрес страницы требует на 12 бит меньше размера адресной шины (младшие 12 бит всегда 0). Для 32-битных адресов значимыми битами адреса будут старшие 20 бит их и передают по адресной шине.  
  
Каталог страниц должен быть выравнен на границу 4 КБ, его адрес будет содержать нули в младших 12 разрядах, а 20 старших, следовательно, будут нести информацию. Эти 20 разрядов и хранятся в регистре CR3 - база каталога страниц (физический адрес расположения PD).
```asm
# Загрузить физический адрес каталога страниц в регистр cr3
mov	eax, Page_Directory_PHysical_Address
mov	cr3, eax

# Получить текущий адрес каталога страниц
mov eax, cr3
```
![image](https://github.com/alzoi/st_os/assets/20499566/e680da1f-1414-4627-bb67-f69140f215ea)

![image](https://github.com/alzoi/st_os/assets/20499566/a10bff77-e1b6-4c47-b66d-db86f9064100)

![image](https://github.com/alzoi/st_os/assets/20499566/b5adb4d6-e057-48ce-bb98-71772053839f)

![image](https://github.com/alzoi/st_os/assets/20499566/beb83e43-adc8-474e-85c5-2c9cef96bbfc)


![image](https://github.com/alzoi/st_os/assets/20499566/8ee54cca-d845-4513-be6a-1f2d494cfe82)  
Можно использовать страницы по 4 МБ  
![image](https://github.com/alzoi/st_os/assets/20499566/fc0af7dc-ca30-48bf-83bf-8d08ca8d9a65)

## Заготовка для разработки ядра ОС
https://wiki.osdev.org/Bare_Bones  
https://wiki.osdev.org/Higher_Half_x86_Bare_Bones
